# 실행 중 서버 중단 문제

서버 프로그램이 클라이언트와 통신하는 도중 간헐적으로 오류 메시지 없이 종료됨

## 문제 분석

- 세그멘테이션 오류도 아니고 컴파일 시에 디버깅 옵션으로 체크하였으나 오류에 대한 내용이 뜨지 않았음
- `echo $?` 명령을 통해 웹서버 프로그램의 종료 코드를 분석해보기로 함.
    - SIGPIPE 오류로 밝혀짐
    - 연결이 끊어진 fd에 입출력을 하면 발생함
- 추가적으로 `lsof -i:[포트번호]` 명령을 이용해 정확히 무슨 상태인지 체크하는 것이 큰 도움이 되었다.

## 원인

유닉스계열 os에서 소켓 통신을 하는 프로그램이 이미 연결이 종료된 파일 디스크립터에 대해 작업을 수행할 때 프로그램은 SIGPIPE 시그널을 발생시키며 종료된다.

주로 클라이언트가 먼저 TCP 연결을 종료할 때 발생한다.

## 해결

소켓 이벤트 발생 시 먼저 Close 여부를 확인하여 Close된 소켓에 Read 및 Write 작업을 금지한다.

# 대용량 파일 수신 및 송신 시에 속도 개선

## 문제 분석

- `ab` 명령을 이용해 부하 테스트 결과 nginx에 비해 스루풋이 너무 낮음
    - `ab -c [동시 사용자 수] -n [요청 수] -t [테스트 시간] [URL]`

## 원인

- 데이터를 수신하거나 송신할 때 데이터 버퍼가 너무 작아서 너무 많은 폴링 횟수로 비효율적으로 동작함

## 해결

데이터 버퍼를 동적으로 적절한 크기로 설정하도록 변경함